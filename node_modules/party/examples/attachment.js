
/**
 * Module dependencies.
 */

var party = require('../')
  , fs = require('fs')
  , file = __dirname + '/../test/cases/lua-pdf'
  , str = fs.readFileSync(file, 'ascii').replace(/\n/g, '\r\n')
  , str = new Buffer(str);

var parser = party.createParser('0016e6d778cd7cb71404a4d3743e');

parser.on('part', function(part){
  // ignore non-attachments
  if (part.isAttachment) {
    console.log('\nPART:');
    console.log(part.header);
    var filename = part.param('content-disposition', 'filename')
      , stream = fs.createWriteStream(__dirname + '/' + filename);
    part.decode().pipe(stream);
    part.on('end', function(){
      console.log('saved attachment %s', filename);
    });
  }
});

parser.on('end', function(){
  console.log('\nEND');
});

parser.parse(str);
